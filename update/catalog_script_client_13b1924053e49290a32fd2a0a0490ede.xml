<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="catalog_script_client">
    <catalog_script_client action="INSERT_OR_UPDATE">
        <active>true</active>
        <applies_catalog>true</applies_catalog>
        <applies_extended>false</applies_extended>
        <applies_req_item>false</applies_req_item>
        <applies_sc_task>false</applies_sc_task>
        <applies_target_record>false</applies_target_record>
        <applies_to>set</applies_to>
        <cat_item/>
        <cat_variable/>
        <condition/>
        <description/>
        <field/>
        <global>true</global>
        <isolate_script>true</isolate_script>
        <messages/>
        <name>set value</name>
        <order/>
        <published_ref/>
        <script><![CDATA[function onSubmit() {
    // 初始化GlideVariableSet对象，用于获取推荐信息
    var recommend = new GlideVariableSet("recommend_test");

    // 定义一个对象来存储从GlideVariableSet获取的值
    var recommendValues = {
        type: recommend.getValue("type_for_recommend"),
        title: recommend.getValue("title_recommend"),
        bv: recommend.getValue("bv_recommend"),
        url: recommend.getValue("url_recommend"),
        reason: recommend.getValue("reason_recommend")
    };

    // 检查GlideVariableSet是否返回了预期的值，如果没有，则使用默认值或抛出错误
    for (var key in recommendValues) {
        if (recommendValues[key] === undefined || recommendValues[key] === null) {
            // 可以选择抛出错误或使用默认值
            // throw new Error("Missing value for " + key);
            recommendValues[key] = "Default Value for " + key;
        }
    }

    // 初始化g_form对象，用于访问和修改表单字段
    var g_form = new GlideForm();

    // 对于选择框，可能需要将值转换为对应的选项值
    // 假设u_recommend_type是一个选择框，其选项值存储在g_form.getDisplayValue("u_recommend_type", recommendValues.type)中
    g_form.setValue("u_recommend_type", g_form.getDisplayValue("u_recommend_type", recommendValues.type));

    // 对于URL字段，确保赋值的字符串是一个有效的URL
    // 如果不是有效的URL，可以使用默认值或抛出错误
    if (isValidURL(recommendValues.url)) {
        g_form.setValue("u_recommend_url", recommendValues.url);
    } else {
        // 使用默认值或抛出错误
        // g_form.setValue("u_recommend_url", "http://www.example.com");
        throw new Error("Invalid URL provided for u_recommend_url");
    }

    // 其他字段赋值
    g_form.setValue("u_recommend_title", recommendValues.title);
    g_form.setValue("u_recommend_bv", recommendValues.bv);
    g_form.setValue("u_recommend_reason", recommendValues.reason);

    // 提交表单或执行其他操作
    // g_form.submit();
}

// 用于检查字符串是否为有效URL的辅助函数
function isValidURL(str) {
    var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
        '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
        '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
        '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
        '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
        '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
    return !!pattern.test(str);
}]]></script>
        <sys_class_name>catalog_script_client</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-05 07:57:36</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>13b1924053e49290a32fd2a0a0490ede</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>set value</sys_name>
        <sys_overrides/>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>catalog_script_client_13b1924053e49290a32fd2a0a0490ede</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-05 08:41:00</sys_updated_on>
        <table/>
        <type>onSubmit</type>
        <ui_type>10</ui_type>
        <va_supported>false</va_supported>
        <variable_set display_value="推薦明細">899fad4853ac5290a32fd2a0a0490e87</variable_set>
        <view/>
    </catalog_script_client>
</record_update>
